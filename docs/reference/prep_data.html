<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Prepare data for machine learning — prep_data • healthcareai</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>


<!-- docsearch -->
<script src="../docsearch.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>


<meta property="og:title" content="Prepare data for machine learning — prep_data" />

<meta property="og:description" content="prep_data will prepare your data for machine learning.
  Some steps enhance predictive power, some make sure that the data format is
  compatible with a wide array of machine learning algorithms, and others
  provide protection against common problems in model deployment. The
  following steps are available; those followed by * are applied by default.
  Many have customization options.
Convert columns with
  only 0/1 to factor*
Remove columns with near-zero variance*
Convert date columns to useful features*
Fill in missing
  values via imputation*
Collapse rare categories into &quot;other&quot;*
Center numeric columns
Standardize numeric columns
Create dummy variables from categorical variables*
Add
  protective levels to factors for rare and missing data*
While preparing
  your data, a recipe will be generated for identical transformation of
  future data and stored in the `recipe` attribute of the output data frame.
  If a recipe object is passed to `prep_data` via the `recipe` argument, that
  recipe will be applied to the data. This allows you to transform data in
  model training and apply exactly the same transformations in model testing
  and deployment. The new data must be identical in structure to the data
  that the recipe was prepared with." />

<meta property="og:image" content="https://docs.healthcare.ai/logo.png" />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-85609357-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-85609357-1');
</script>

  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">healthcareai</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">2.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/site_only/healthcareai.html">Getting Started</a>
    </li>
    <li>
      <a href="../articles/site_only/db_connections.html">Database Connections</a>
    </li>
    <li>
      <a href="../articles/site_only/deploy_model.html">Deploying a Model</a>
    </li>
    <li>
      <a href="../articles/site_only/best_levels.html">Variables with Many Categories</a>
    </li>
    <li>
      <a href="../articles/site_only/performance.html">Performance with Big Data</a>
    </li>
    <li>
      <a href="../articles/site_only/transitioning.html">Transition from Version 1</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/HealthCatalyst/healthcareai-r">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://healthcare-ai.slack.com/">
    <span class="fa fa-users"></span>
     
  </a>
</li>
      </ul>
      
      <form class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
        </div>
      </form>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Prepare data for machine learning</h1>
    
    <div class="hidden name"><code>prep_data.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p><code>prep_data</code> will prepare your data for machine learning.
  Some steps enhance predictive power, some make sure that the data format is
  compatible with a wide array of machine learning algorithms, and others
  provide protection against common problems in model deployment. The
  following steps are available; those followed by * are applied by default.
  Many have customization options.</p><ol>
<li><p>Convert columns with
  only 0/1 to factor*</p></li>
<li><p>Remove columns with near-zero variance*</p></li>
<li><p>Convert date columns to useful features*</p></li>
<li><p>Fill in missing
  values via imputation*</p></li>
<li><p>Collapse rare categories into "other"*</p></li>
<li><p>Center numeric columns</p></li>
<li><p>Standardize numeric columns</p></li>
<li><p>Create dummy variables from categorical variables*</p></li>
<li><p>Add
  protective levels to factors for rare and missing data*</p></li>
</ol><p>While preparing
  your data, a recipe will be generated for identical transformation of
  future data and stored in the `recipe` attribute of the output data frame.
  If a recipe object is passed to `prep_data` via the `recipe` argument, that
  recipe will be applied to the data. This allows you to transform data in
  model training and apply exactly the same transformations in model testing
  and deployment. The new data must be identical in structure to the data
  that the recipe was prepared with.</p>
    
    </div>

    <pre class="usage"><span class='fu'>prep_data</span>(<span class='no'>d</span>, <span class='no'>...</span>, <span class='no'>outcome</span>, <span class='kw'>recipe</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>remove_near_zero_variance</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>convert_dates</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>impute</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>collapse_rare_factors</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>center</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>scale</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>make_dummies</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>add_levels</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>factor_outcome</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>d</th>
      <td><p>A data frame</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Optional. Columns to be ignored in preparation and model training,
e.g. ID columns. Unquoted; any number of columns can be included here.</p></td>
    </tr>
    <tr>
      <th>outcome</th>
      <td><p>Optional. Unquoted column name that indicates the target
variable. If provided, argument must be named. If this target is 0/1, it
will be coerced to Y/N if factor_outcome is TRUE; other manipulation steps
will not be applied to the outcome.</p></td>
    </tr>
    <tr>
      <th>recipe</th>
      <td><p>Optional. Recipe for how to prep d. In model deployment, pass
the output from this function in training to this argument in deployment to
prepare the deployment data identically to how the training data was
prepared. If training data is big, pull the recipe from the "recipe"
attribute of the prepped training data frame and pass that to this
argument. If present, all following arguments will be ignored.</p></td>
    </tr>
    <tr>
      <th>remove_near_zero_variance</th>
      <td><p>Logical or numeric. If TRUE (default),
columns with near-zero variance will be removed. These columns are either a
single value, or the most common value is much more frequent than the
second most common value.
Example: In a column with 120 "Male" and 2 "Female", the frequency ratio is
0.0167. It would be excluded by default or if
`remove_near_zero_variance` &gt; 0.0166. Larger values will remove more columns
and this value must lie between 0 and 1.</p></td>
    </tr>
    <tr>
      <th>convert_dates</th>
      <td><p>Logical or character. If TRUE (default), date columns
are identifed and used to generate day-of-week, month, and year columns,
and the original date columns are removed. If FALSE, date columns are
removed. If a character vector, it is passed to the `features` argument of
`recipes::step_date`. E.g. if you want only quarter and year back:
`convert_dates = c("quarter", "year")`.</p></td>
    </tr>
    <tr>
      <th>impute</th>
      <td><p>Logical or list. If TRUE (default), columns will be imputed
using mean (numeric), and new category (nominal). If FALSE, data will not
be imputed. If this is a list, it must be named, with possible entries for
`numeric_method`, `nominal_method`, `numeric_params`, `nominal_params`,
which are passed to <code><a href='hcai_impute.html'>hcai_impute</a></code>.</p></td>
    </tr>
    <tr>
      <th>collapse_rare_factors</th>
      <td><p>Logical or numeric. If TRUE (default), factor
levels representing less than 3 percent of observations will be collapsed
into a new category, `other`. If numeric, must be in 0, 1, and is the
proportion of observations below which levels will be grouped into other.
See `recipes::step_other`.</p></td>
    </tr>
    <tr>
      <th>center</th>
      <td><p>Logical. If TRUE, numeric columns will be centered to have a
mean of 0. Default is FALSE.</p></td>
    </tr>
    <tr>
      <th>scale</th>
      <td><p>Logical. If TRUE, numeric columns will be scaled to have a
standard deviation of 1. Default is FALSE.</p></td>
    </tr>
    <tr>
      <th>make_dummies</th>
      <td><p>Logical. If TRUE (default), dummy columns will be created
for categorical variables.</p></td>
    </tr>
    <tr>
      <th>add_levels</th>
      <td><p>Logical. If TRUE (defaults), "other" and "missing" will be
added to all nominal columns. This is protective in deployment: new levels
found in deployment will become "other" and missingness in deployment can
become "missing" if the nominal imputation method is "new_category". If
FALSE, these "other" will be added to all nominal variables if
<code>collapse_rare_factors</code> is used, and "missingness" may be added
depending on details of imputation.</p></td>
    </tr>
    <tr>
      <th>factor_outcome</th>
      <td><p>Logical. If TRUE (default) and if all entries in
outcome are 0 or 1 they will be converted to factor with levels N and Y for
classification. Note that which level is the positive class is set in
training functions rather than here.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Prepared data frame with reusable recipe object for future data
  preparation in attribute "recipe". Attribute recipe contains the names of
  ignored columns (those passed to ...) in attribute "ignored_columns".</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>To let data preparation happen automatically under the hood, see
  <code><a href='machine_learn.html'>machine_learn</a></code></p>
<p>To take finer control of imputation, see <code><a href='impute.html'>impute</a></code>, and for
  finer control of data prep in general check out the recipes package:
  <a href='https://topepo.github.io/recipes/'>https://topepo.github.io/recipes/</a></p>
<p>To train models on prepared data, see <code><a href='tune_models.html'>tune_models</a></code> and
  <code><a href='flash_models.html'>flash_models</a></code></p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='no'>d_train</span> <span class='kw'>&lt;-</span> <span class='no'>pima_diabetes</span>[<span class='fl'>1</span>:<span class='fl'>700</span>, ]
<span class='no'>d_test</span> <span class='kw'>&lt;-</span> <span class='no'>pima_diabetes</span>[<span class='fl'>701</span>:<span class='fl'>768</span>, ]

<span class='co'># Prep data. Ignore patient_id (identifier) and treat diabetes as outcome</span>
<span class='no'>d_train_prepped</span> <span class='kw'>&lt;-</span> <span class='fu'>prep_data</span>(<span class='kw'>d</span> <span class='kw'>=</span> <span class='no'>d_train</span>, <span class='no'>patient_id</span>, <span class='kw'>outcome</span> <span class='kw'>=</span> <span class='no'>diabetes</span>)</div><div class='output co'>#&gt; <span class='message'>Training new data prep recipe...</span></div><div class='input'>
<span class='co'># Prep test data by reapplying the same transformations as to training data</span>
<span class='no'>d_test_prepped</span> <span class='kw'>&lt;-</span> <span class='fu'>prep_data</span>(<span class='no'>d_test</span>, <span class='kw'>recipe</span> <span class='kw'>=</span> <span class='no'>d_train_prepped</span>)</div><div class='output co'>#&gt; <span class='message'>Prepping data based on provided recipe</span></div><div class='input'>
<span class='co'># View the transformations applied and the prepped data</span>
<span class='no'>d_test_prepped</span></div><div class='output co'>#&gt; <span class='message'>healthcareai-prepped data. Recipe used to prepare data:</span></div><div class='output co'>#&gt; Data Recipe
#&gt; 
#&gt; Inputs:
#&gt; 
#&gt;       role #variables
#&gt;    outcome          1
#&gt;  predictor          8
#&gt; 
#&gt; Training data contained 700 data points and 340 incomplete rows. 
#&gt; 
#&gt; Operations:
#&gt; 
#&gt; Sparse, unbalanced variable filter removed no terms [trained]
#&gt; Mean Imputation for pregnancies, plasma_glucose, ... [trained]
#&gt; Filling NA with missing for weight_class [trained]
#&gt; Adding levels to: other, missing [trained]
#&gt; Collapsing factor levels for weight_class [trained]
#&gt; Adding levels to: other, missing [trained]
#&gt; Dummy variables from weight_class [trained]</div><div class='output co'>#&gt; <span class='message'>Current data:</span></div><div class='output co'>#&gt; # A tibble: 68 x 13
#&gt;    pregnancies plasma_glucose diastolic_bp skinfold insulin pedigree   age
#&gt;          &lt;int&gt;          &lt;int&gt;        &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt;
#&gt;  1           2            122         76       27      200     0.483    26
#&gt;  2           6            125         78       31      154.    0.565    49
#&gt;  3           1            168         88       29      154.    0.905    52
#&gt;  4           2            129         72.3     29.1    154.    0.304    41
#&gt;  5           4            110         76       20      100     0.118    27
#&gt;  6           6             80         80       36      154.    0.177    28
#&gt;  7          10            115         72.3     29.1    154.    0.261    30
#&gt;  8           2            127         46       21      335     0.176    22
#&gt;  9           9            164         78       29.1    154.    0.148    45
#&gt; 10           2             93         64       32      160     0.674    23
#&gt; # ... with 58 more rows, and 6 more variables: diabetes &lt;fct&gt;,
#&gt; #   weight_class_normal &lt;dbl&gt;, weight_class_obese &lt;dbl&gt;,
#&gt; #   weight_class_overweight &lt;dbl&gt;, weight_class_other &lt;dbl&gt;,
#&gt; #   weight_class_missing &lt;dbl&gt;</div><div class='input'>
<span class='co'># Customize preparations:</span>
<span class='fu'>prep_data</span>(<span class='kw'>d</span> <span class='kw'>=</span> <span class='no'>d_train</span>, <span class='no'>patient_id</span>, <span class='kw'>outcome</span> <span class='kw'>=</span> <span class='no'>diabetes</span>,
          <span class='kw'>impute</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='kw'>numeric_method</span> <span class='kw'>=</span> <span class='st'>"bagimpute"</span>,
                        <span class='kw'>nominal_method</span> <span class='kw'>=</span> <span class='st'>"bagimpute"</span>),
          <span class='kw'>collapse_rare_factors</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>convert_dates</span> <span class='kw'>=</span> <span class='st'>"year"</span>,
          <span class='kw'>center</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>scale</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>make_dummies</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
          <span class='kw'>remove_near_zero_variance</span> <span class='kw'>=</span> <span class='fl'>.02</span>)</div><div class='output co'>#&gt; <span class='message'>Training new data prep recipe...</span></div><div class='output co'>#&gt; <span class='message'>healthcareai-prepped data. Recipe used to prepare data:</span></div><div class='output co'>#&gt; Data Recipe
#&gt; 
#&gt; Inputs:
#&gt; 
#&gt;       role #variables
#&gt;    outcome          1
#&gt;  predictor          8
#&gt; 
#&gt; Training data contained 700 data points and 340 incomplete rows. 
#&gt; 
#&gt; Operations:
#&gt; 
#&gt; Sparse, unbalanced variable filter removed no terms [trained]
#&gt; Bagged tree imputation for pregnancies, plasma_glucose, ... [trained]
#&gt; Bagged tree imputation for weight_class [trained]
#&gt; Centering for pregnancies, plasma_glucose, ... [trained]
#&gt; Scaling for pregnancies, plasma_glucose, ... [trained]
#&gt; Adding levels to: other, missing [trained]
#&gt; Adding levels to: other, missing [trained]</div><div class='output co'>#&gt; <span class='message'>Current data:</span></div><div class='output co'>#&gt; # A tibble: 700 x 10
#&gt;    patient_id pregnancies plasma_glucose diastolic_bp skinfold insulin
#&gt;         &lt;int&gt;       &lt;dbl&gt;          &lt;dbl&gt;        &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;
#&gt;  1          1       0.646          0.872      -0.0205  0.631     0.434
#&gt;  2          2      -0.840         -1.19       -0.513   0.00950  -0.849
#&gt;  3          3       1.24           2.02       -0.678  -0.765     0.605
#&gt;  4          4      -0.840         -1.06       -0.513  -0.612    -0.603
#&gt;  5          5      -1.14           0.512      -2.65    0.631     0.135
#&gt;  6          6       0.349         -0.175       0.144  -0.454    -0.273
#&gt;  7          7      -0.246         -1.42       -1.83    0.320    -0.663
#&gt;  8          8       1.83          -0.208      -0.0477  0.408    -0.223
#&gt;  9          9      -0.543          2.47       -0.185   1.67      3.88 
#&gt; 10         10       1.24           0.119       1.95    0.333     0.984
#&gt; # ... with 690 more rows, and 4 more variables: weight_class &lt;fct&gt;,
#&gt; #   pedigree &lt;dbl&gt;, age &lt;dbl&gt;, diabetes &lt;fct&gt;</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Levi Thatcher, Michael Levy, Mike Mastanduno, Taylor Larsen, Taylor Miller.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script>
  docsearch({
    
    
    apiKey: 'ac39465bc37cbef616f5de1e646b6037',
    indexName: 'healthcareai',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>


  </body>
</html>

