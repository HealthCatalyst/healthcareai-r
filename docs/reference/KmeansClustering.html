<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Build clusters using kmeans() — KmeansClustering • healthcareai</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  <link href="../extra.css" rel="stylesheet">
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">healthcareai</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/site_only/fake_vignette.html">fake vignette</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Build clusters using kmeans()</h1>
    </div>

    
    <p>This step allows you to use kmeans clustering to explore and
  group your data.</p>
    

    <pre class="usage"><span class='fu'>KmeansClustering</span>(<span class='no'>object</span>, <span class='no'>df</span>, <span class='no'>grainCol</span>, <span class='no'>labelCol</span>, <span class='no'>numOfClusters</span>,
  <span class='no'>usePCA</span>, <span class='no'>numOfPCA</span>,<span class='no'>impute</span>, <span class='no'>debug</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>object</th>
      <td><p>of UnsupervisedModelParams class for $new() constructor</p></td>
    </tr>
    <tr>
      <th>df</th>
      <td><p>Dataframe whose columns are used for calc.</p></td>
    </tr>
    <tr>
      <th>grainCol</th>
      <td><p>Optional. The dataframe's column that has IDs pertaining to 
the grain. No ID columns are truly needed for this step. If left blank, row
numbers are used for identification.</p></td>
    </tr>
    <tr>
      <th>labelCol</th>
      <td><p>Optional. Labels will not be used for clustering. Labels can
be can be used for validation. The number of clusters should be the same as
the number of labels. Functions getClusterLabels() and getConfusionMatrix()
are only available if labelCol is provided. Generally, supervised models
are a better choice if your goal is classification.</p></td>
    </tr>
    <tr>
      <th>numOfClusters</th>
      <td><p>Number of clusters you want to build. If left blank,
will be determined automatically from the elbow plot.</p></td>
    </tr>
    <tr>
      <th>usePCA</th>
      <td><p>Optional. TRUE or FALSE. Default is FALSE. If TRUE, the
method will use principle components as the new features to perform K-means
clustering. This may accelerate convergence on high-dimension datasets.</p></td>
    </tr>
    <tr>
      <th>numOfPCA</th>
      <td><p>Optional. If using principle components, you may specify
the number to use to perform K-means clustering. If left blank, it will be
determined automatically from the scree (elbow) plot.</p></td>
    </tr>
    <tr>
      <th>impute</th>
      <td><p>Set all-column imputation to FALSE or TRUE. This uses mean
replacement for numeric columns and most frequent for factorized columns. 
FALSE leads to removal of rows containing NULLs.</p></td>
    </tr>
    <tr>
      <th>debug</th>
      <td><p>Provides the user extended output to the console, in order to
monitor the calculations throughout. Use TRUE or FALSE.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="format"><a class="anchor" href="#format"></a>Format</h2>

    <p>An object of class <code>R6ClassGenerator</code> of length 24.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This is an unsupervised method for clustering data. That is, no
  response variable is needed or used. If you want to examine how the data
  clusters by some labeled grouping, you can specify the grouping in
  <code>labelCol</code>, but the labels are not used in
  the clustering process. If you want to use labels to train the model 
  see <code><a href='LassoDevelopment.html'>LassoDevelopment</a></code> or <code><a href='RandomForestDevelopment.html'>RandomForestDevelopment</a></code>.</p>
    
    <h2 class="hasAnchor" id="methods"><a class="anchor" href="#methods"></a>Methods</h2>

    <p>The above describes params for initializing a new
  KmeansClustering class with <code>$new()</code>. Individual methods are
  documented below.</p>
    
    <h2 class="hasAnchor" id="-code-new-code-"><a class="anchor" href="#-code-new-code-"></a>&lt;code&gt;$new()&lt;/code&gt;</h2>

    <p>Initializes a new Kmeans Clustering class using the 
  parameters saved in <code>p</code>, documented above. This method loads, cleans,
  and prepares data for clustering.  <em>Usage:</em> <code>$new(p)</code></p>
    
    <h2 class="hasAnchor" id="-code-run-code-"><a class="anchor" href="#-code-run-code-"></a>&lt;code&gt;$run()&lt;/code&gt;</h2>

    <p>Calculates clusters, displays performance.  
  <em>Usage:</em><code>$run()</code></p>
    
    <h2 class="hasAnchor" id="-code-get-dclustersplot-code-"><a class="anchor" href="#-code-get-dclustersplot-code-"></a>&lt;code&gt;$get2DClustersPlot()&lt;/code&gt;</h2>

    <p>Displays the data and assigned
  clusters. PCA is used to visualize the top two priciple components for
  plotting. This is unrelated to variable reduction for clustering. Passing 
  TRUE to this function will display grain IDs on the plot.  
  <em>Usage:</em> <code>$get2DClustersPlot()</code></p>
    
    <h2 class="hasAnchor" id="-code-getoutdf-code-"><a class="anchor" href="#-code-getoutdf-code-"></a>&lt;code&gt;$getOutDf()&lt;/code&gt;</h2>

    <p>Returns the output dataframe for writing to SQL
  or CSV.  <em>Usage:</em> <code>$getOutDf()</code></p>
    
    <h2 class="hasAnchor" id="-code-getconfusionmatrix-code-"><a class="anchor" href="#-code-getconfusionmatrix-code-"></a>&lt;code&gt;$getConfusionMatrix()&lt;/code&gt;</h2>

    <p>Returns a confusion matrix of assigned
  cluster vs. provided labels. Clusters are named based on maximum overlap
  with label. Only available if labelCol is specified. Rows are true labels,
  columns are assigned clusters.  
<em>Usage:</em> <code>$getConfusionMatrix()</code></p>
    
    <h2 class="hasAnchor" id="-code-getelbowplot-code-"><a class="anchor" href="#-code-getelbowplot-code-"></a>&lt;code&gt;$getElbowPlot()&lt;/code&gt;</h2>

    <p>Plots total within cluster error vs. number
  of clusters. Available if the number of clusters is unspecified.  
  <em>Usage:</em> <code>$getElbowPlot()</code></p>
    
    <h2 class="hasAnchor" id="-code-getscreeplot-code-"><a class="anchor" href="#-code-getscreeplot-code-"></a>&lt;code&gt;$getScreePlot()&lt;/code&gt;</h2>

    <p>Plots total variance explained vs. number of
  principle components. Available if the number of principle components is
  unspecified.  <em>Usage:</em> <code>$getScreePlot()</code></p>
    
    <h2 class="hasAnchor" id="-code-getkmeansfit-code-"><a class="anchor" href="#-code-getkmeansfit-code-"></a>&lt;code&gt;$getKmeansFit()&lt;/code&gt;</h2>

    <p>Returns all attributes of the kmeans fit
  object.  <em>Usage:</em> <code>$getKmeansFit()</code></p>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p><a href='http://hctools.org/'>http://hctools.org/</a>
    <a href='https://github.com/bryanhanson/ChemoSpecMarkeR/blob/master/R/findElbow.R'>https://github.com/bryanhanson/ChemoSpecMarkeR/blob/master/R/findElbow.R</a></p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <p><code><a href='healthcareai.html'>healthcareai</a></code></p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='co'>#### Example using Diabetes dataset ####</span>
<span class='no'>ptm</span> <span class='kw'>&lt;-</span> <span class='fu'>proc.time</span>()
<span class='co'># Can delete this line in your work</span>
<span class='no'>csvfile</span> <span class='kw'>&lt;-</span> <span class='fu'>system.file</span>(<span class='st'>"extdata"</span>,
                       <span class='st'>"HCRDiabetesClinical.csv"</span>,
                       <span class='kw'>package</span> <span class='kw'>=</span> <span class='st'>"healthcareai"</span>)
<span class='co'># Replace csvfile with 'your/path'</span>
<span class='no'>df</span> <span class='kw'>&lt;-</span> <span class='fu'>read.csv</span>(<span class='kw'>file</span> <span class='kw'>=</span> <span class='no'>csvfile</span>,
               <span class='kw'>header</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
               <span class='kw'>na.strings</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"NULL"</span>, <span class='st'>"NA"</span>, <span class='st'>""</span>))
<span class='fu'>head</span>(<span class='no'>df</span>)</div><div class='output co'>#&gt;   PatientEncounterID PatientID SystolicBPNBR LDLNBR A1CNBR GenderFLG
#&gt; 1                  1     10001           167    195    4.2         M
#&gt; 2                  2     10001           153    214    5.0         M
#&gt; 3                  3     10001           170    191    4.0         M
#&gt; 4                  4     10002           187    135    4.4         M
#&gt; 5                  5     10002           188    125    4.3         M
#&gt; 6                  6     10002           185    178    5.0         M
#&gt;   ThirtyDayReadmitFLG
#&gt; 1                   N
#&gt; 2                   N
#&gt; 3                   N
#&gt; 4                   N
#&gt; 5                   N
#&gt; 6                   N</div><div class='input'><span class='no'>df</span>$<span class='no'>PatientID</span> <span class='kw'>&lt;-</span> <span class='kw'>NULL</span>

<span class='fu'>set.seed</span>(<span class='fl'>42</span>)
<span class='no'>p</span> <span class='kw'>&lt;-</span> <span class='no'>UnsupervisedModelParams</span>$<span class='fu'>new</span>()
<span class='no'>p</span>$<span class='no'>df</span> <span class='kw'>&lt;-</span> <span class='no'>df</span>
<span class='no'>p</span>$<span class='no'>impute</span> <span class='kw'>&lt;-</span> <span class='fl'>TRUE</span>
<span class='no'>p</span>$<span class='no'>grainCol</span> <span class='kw'>&lt;-</span> <span class='st'>"PatientEncounterID"</span>
<span class='no'>p</span>$<span class='no'>debug</span> <span class='kw'>&lt;-</span> <span class='fl'>FALSE</span>
<span class='no'>p</span>$<span class='no'>cores</span> <span class='kw'>&lt;-</span> <span class='fl'>1</span>
<span class='no'>p</span>$<span class='no'>numOfClusters</span> <span class='kw'>&lt;-</span> <span class='fl'>3</span>

<span class='co'># Run k means clustering</span>
<span class='no'>cl</span> <span class='kw'>&lt;-</span> <span class='no'>KmeansClustering</span>$<span class='fu'>new</span>(<span class='no'>p</span>)
<span class='no'>cl</span>$<span class='fu'>run</span>()</div><div class='output co'>#&gt; Total sum of squares errors within clusters is: 3054.684 
#&gt; Sum of squares errors in each cluster is:
#&gt;   clusterNum clusterName withinClusterSS
#&gt; 1          1           1        610.2656
#&gt; 2          2           2       1240.8553
#&gt; 3          3           3       1203.5628</div><div class='input'>
<span class='co'># Get the 2D representation of the cluster solution</span>
<span class='no'>cl</span>$<span class='fu'>get2DClustersPlot</span>()</div><div class='img'><img src='KmeansClustering-1.png' alt='' width='700' height='432.632880098887' /></div><div class='input'>
<span class='co'># Get the output data frame</span>
<span class='no'>dfOut</span> <span class='kw'>&lt;-</span> <span class='no'>cl</span>$<span class='fu'>getOutDf</span>()
<span class='fu'>head</span>(<span class='no'>dfOut</span>)</div><div class='output co'>#&gt;   BindingID BindingNM         LastLoadDTS Grain assignedCluster
#&gt; 1         0         R 2017-10-24 14:56:59     1               3
#&gt; 2         0         R 2017-10-24 14:56:59     2               3
#&gt; 3         0         R 2017-10-24 14:56:59     3               3
#&gt; 4         0         R 2017-10-24 14:56:59     4               3
#&gt; 5         0         R 2017-10-24 14:56:59     5               3
#&gt; 6         0         R 2017-10-24 14:56:59     6               3</div><div class='input'>
<span class='fu'>print</span>(<span class='fu'>proc.time</span>() - <span class='no'>ptm</span>)</div><div class='output co'>#&gt;    user  system elapsed 
#&gt;   0.891   0.012   0.909 </div><div class='input'>



<span class='co'>#### Example using iris dataset with labels ####</span>
<span class='no'>ptm</span> <span class='kw'>&lt;-</span> <span class='fu'>proc.time</span>()
<span class='fu'>library</span>(<span class='no'>healthcareai</span>)

<span class='fu'>data</span>(<span class='no'>iris</span>)
<span class='fu'>head</span>(<span class='no'>iris</span>)</div><div class='output co'>#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
#&gt; 1          5.1         3.5          1.4         0.2  setosa
#&gt; 2          4.9         3.0          1.4         0.2  setosa
#&gt; 3          4.7         3.2          1.3         0.2  setosa
#&gt; 4          4.6         3.1          1.5         0.2  setosa
#&gt; 5          5.0         3.6          1.4         0.2  setosa
#&gt; 6          5.4         3.9          1.7         0.4  setosa</div><div class='input'>
<span class='fu'>set.seed</span>(<span class='fl'>2017</span>)

<span class='no'>p</span> <span class='kw'>&lt;-</span> <span class='no'>UnsupervisedModelParams</span>$<span class='fu'>new</span>()
<span class='no'>p</span>$<span class='no'>df</span> <span class='kw'>&lt;-</span> <span class='no'>iris</span>
<span class='no'>p</span>$<span class='no'>labelCol</span> <span class='kw'>&lt;-</span> <span class='st'>'Species'</span>
<span class='no'>p</span>$<span class='no'>impute</span> <span class='kw'>&lt;-</span> <span class='fl'>TRUE</span>
<span class='no'>p</span>$<span class='no'>debug</span> <span class='kw'>&lt;-</span> <span class='fl'>FALSE</span>
<span class='no'>p</span>$<span class='no'>cores</span> <span class='kw'>&lt;-</span> <span class='fl'>1</span>

<span class='co'># Run k means clustering</span>
<span class='no'>cl</span> <span class='kw'>&lt;-</span> <span class='no'>KmeansClustering</span>$<span class='fu'>new</span>(<span class='no'>p</span>)</div><div class='output co'>#&gt; <span class='message'>Kmeans is ideal for unlabeled data. The label column here is meant </span>
#&gt; <span class='message'>for comparison after clustering. If you are trying to do classification,</span>
#&gt; <span class='message'>we recommend that you use supervised multiclass.</span></div><div class='input'><span class='no'>cl</span>$<span class='fu'>run</span>()</div><div class='output co'>#&gt; Confusion matrix for cluster assignment, given as proportion correct. 
#&gt; 
#&gt;           Columns are assigned clusters, Rows are true labels.           setosa versicolor virginica
#&gt; setosa          1       0.00      0.00
#&gt; versicolor      0       0.78      0.22
#&gt; virginica       0       0.28      0.72
#&gt; 
#&gt; Total sum of squares errors within clusters is: 138.8884 
#&gt; Sum of squares errors in each cluster is:
#&gt;   clusterNum clusterName withinClusterSS
#&gt; 1          1      setosa        47.35062
#&gt; 2          2  versicolor        44.08754
#&gt; 3          3   virginica        47.45019</div><div class='input'>
<span class='co'># Get the 2D representation of the cluster solution</span>
<span class='no'>cl</span>$<span class='fu'>get2DClustersPlot</span>()</div><div class='img'><img src='KmeansClustering-2.png' alt='' width='700' height='432.632880098887' /></div><div class='input'>
<span class='co'># Get the output data frame</span>
<span class='no'>dfOut</span> <span class='kw'>&lt;-</span> <span class='no'>cl</span>$<span class='fu'>getOutDf</span>()
<span class='fu'>head</span>(<span class='no'>dfOut</span>)</div><div class='output co'>#&gt;   BindingID BindingNM         LastLoadDTS Grain trueGroup assignedCluster
#&gt; 1         0         R 2017-10-24 14:56:59     1    setosa          setosa
#&gt; 2         0         R 2017-10-24 14:56:59     2    setosa          setosa
#&gt; 3         0         R 2017-10-24 14:56:59     3    setosa          setosa
#&gt; 4         0         R 2017-10-24 14:56:59     4    setosa          setosa
#&gt; 5         0         R 2017-10-24 14:56:59     5    setosa          setosa
#&gt; 6         0         R 2017-10-24 14:56:59     6    setosa          setosa</div><div class='input'>
<span class='co'>## Write to CSV (or JSON, MySQL, etc) using plain R syntax</span>
<span class='co'>## write.csv(dfOut,'path/clusteringresult.csv')</span>

<span class='fu'>print</span>(<span class='fu'>proc.time</span>() - <span class='no'>ptm</span>)</div><div class='output co'>#&gt;    user  system elapsed 
#&gt;   0.145   0.004   0.156 </div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#format">Format</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#methods">Methods</a></li>

      <li><a href="#-code-new-code-">&lt;code&gt;$new()&lt;/code&gt;</a></li>

      <li><a href="#-code-run-code-">&lt;code&gt;$run()&lt;/code&gt;</a></li>

      <li><a href="#-code-get-dclustersplot-code-">&lt;code&gt;$get2DClustersPlot()&lt;/code&gt;</a></li>

      <li><a href="#-code-getoutdf-code-">&lt;code&gt;$getOutDf()&lt;/code&gt;</a></li>

      <li><a href="#-code-getconfusionmatrix-code-">&lt;code&gt;$getConfusionMatrix()&lt;/code&gt;</a></li>

      <li><a href="#-code-getelbowplot-code-">&lt;code&gt;$getElbowPlot()&lt;/code&gt;</a></li>

      <li><a href="#-code-getscreeplot-code-">&lt;code&gt;$getScreePlot()&lt;/code&gt;</a></li>

      <li><a href="#-code-getkmeansfit-code-">&lt;code&gt;$getKmeansFit()&lt;/code&gt;</a></li>

      <li><a href="#references">References</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Levi Thatcher, Mike Mastanduno, Michael Levy, Taylor Miller, Taylor Larsen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
